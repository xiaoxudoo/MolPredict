{"version":3,"sources":["../../../source/lib/drawing/picture.js"],"names":["Drawing","require","path","imgsz","mime","EMU","xmlbuilder","Picture","opts","kind","contentType","lookup","type","imagePath","_name","basename","_descr","_title","_id","noGrp","noSelect","noRot","noChangeAspect","noMove","noResize","noEditPoints","noAdjustHandles","noChangeArrowheads","noChangeShapeType","indexOf","position","anchor","from","to","x","y","TypeError","ele","anchorEle","anchorType","editAs","att","_position","af","anchorFrom","afEle","text","col","colOff","row","rowOff","anchorTo","at","atEle","width","height","picEle","nvPicPrEle","cNvPrEle","description","id","name","title","cNvPicPrEle","blipFillEle","rId","spPrEle","xfrmEle","prstGeom","newName","desc","extname","substr","pxWidth","inWidth","emu","value","pxHeight","inHeight","module","exports"],"mappings":"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","file":"picture.js","sourcesContent":["const Drawing = require('./drawing.js');\nconst path = require('path');\nconst imgsz = require('image-size');\nconst mime = require('mime');\n\nconst EMU = require('../classes/emu.js');\nconst xmlbuilder = require('xmlbuilder');\n\nclass Picture extends Drawing {\n\n    /**\n     * Element representing an Excel Picture subclass of Drawing\n     * @property {String} kind Kind of picture (currently only image is supported)\n     * @property {String} contentType Mime type of image\n     * @property {String} type ooxml schema\n     * @property {String} imagePath Filesystem path to image\n     * @property {String} name Name of image\n     * @property {String} description Description of image\n     * @property {String} title Title of image\n     * @property {String} id ID of image\n     * @property {String} noGrp pickLocks property\n     * @property {String} noSelect pickLocks property\n     * @property {String} noRot pickLocks property\n     * @property {String} noChangeAspect pickLocks property\n     * @property {String} noMove pickLocks property\n     * @property {String} noResize pickLocks property\n     * @property {String} noEditPoints pickLocks property\n     * @property {String} noAdjustHandles pickLocks property\n     * @property {String} noChangeArrowheads pickLocks property\n     * @property {String} noChangeShapeType pickLocks property\n     * @returns {Picture} Excel Picture  pickLocks property\n     */\n    constructor(opts) {\n        super();\n        this.kind = 'image';\n        this.contentType = mime.lookup(opts.path);\n        this.type = 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/image';\n        this.imagePath = opts.path;\n        this._name = path.basename(opts.path);\n        this._descr = null;\n        this._title = null;\n        this._id;\n        // picLocks ยง20.1.2.2.31 picLocks (Picture Locks)\n        this.noGrp;\n        this.noSelect;\n        this.noRot;\n        this.noChangeAspect = true;\n        this.noMove;\n        this.noResize;\n        this.noEditPoints;\n        this.noAdjustHandles;\n        this.noChangeArrowheads;\n        this.noChangeShapeType;\n        if (['oneCellAnchor', 'twoCellAnchor'].indexOf(opts.position.type) >= 0) {\n            this.anchor(opts.position.type, opts.position.from, opts.position.to);\n        } else if (opts.position.type === 'absoluteAnchor') {\n            this.position(opts.position.x, opts.position.y);\n        } else {\n            throw new TypeError('Invalid option for anchor type. anchorType must be one of oneCellAnchor, twoCellAnchor, or absoluteAnchor');\n        }\n    }\n\n    get name() {\n        return this._name;\n    }\n    set name(newName) {\n        this._name = newName;\n    }\n    get id() {\n        return this._id;\n    }\n    set id(id) {\n        this._id = id;\n    }\n\n    get rId() {\n        return 'rId' + this._id;\n    }\n\n    get description() {\n        return this._descr !== null ? this._descr : this._name;\n    }\n    set description(desc) {\n        this._descr = desc;\n    }\n\n    get title() {\n        return this._title !== null ? this._title : this._name;\n    }\n    set title(title) {\n        this._title = title;\n    }\n\n    get extension() {\n        return path.extname(this.imagePath).substr(1);\n    }\n    get width() {\n        let pxWidth = imgsz(this.imagePath).width;\n        let inWidth = pxWidth / 96;\n        let emu = new EMU(inWidth + 'in');\n        return emu.value;\n    }\n\n    get height() {\n        let pxHeight = imgsz(this.imagePath).height;\n        let inHeight = pxHeight / 96;\n        let emu = new EMU(inHeight + 'in');\n        return emu.value;\n    }\n\n    /**\n     * @alias Picture.addToXMLele\n     * @desc When generating Workbook output, attaches pictures to the drawings xml file\n     * @func Picture.addToXMLele\n     * @param {xmlbuilder.Element} ele Element object of the xmlbuilder module\n     */\n    addToXMLele(ele) {\n\n        let anchorEle = ele.ele('xdr:' + this.anchorType);\n\n        if (this.editAs !== null) {\n            anchorEle.att('editAs', this.editAs);\n        }\n\n        if (this.anchorType === 'absoluteAnchor') {\n            anchorEle.ele('xdr:pos').att('x', this._position.x).att('y', this._position.y);\n        }\n\n        if (this.anchorType !== 'absoluteAnchor') {\n            let af = this.anchorFrom;\n            let afEle = anchorEle.ele('xdr:from');\n            afEle.ele('xdr:col').text(af.col);\n            afEle.ele('xdr:colOff').text(af.colOff);\n            afEle.ele('xdr:row').text(af.row);\n            afEle.ele('xdr:rowOff').text(af.rowOff);\n        }\n\n        if (this.anchorTo && this.anchorType === 'twoCellAnchor') {\n            let at = this.anchorTo;\n            let atEle = anchorEle.ele('xdr:to');\n            atEle.ele('xdr:col').text(at.col);\n            atEle.ele('xdr:colOff').text(at.colOff);\n            atEle.ele('xdr:row').text(at.row);\n            atEle.ele('xdr:rowOff').text(at.rowOff);                            \n        }\n\n        if (this.anchorType === 'oneCellAnchor' || this.anchorType === 'absoluteAnchor') {\n            anchorEle.ele('xdr:ext').att('cx', this.width).att('cy', this.height);\n        }\n\n        let picEle = anchorEle.ele('xdr:pic');\n        let nvPicPrEle = picEle.ele('xdr:nvPicPr');\n        let cNvPrEle = nvPicPrEle.ele('xdr:cNvPr');\n        cNvPrEle.att('descr', this.description);\n        cNvPrEle.att('id', this.id + 1);\n        cNvPrEle.att('name', this.name);\n        cNvPrEle.att('title', this.title);\n        let cNvPicPrEle = nvPicPrEle.ele('xdr:cNvPicPr');\n\n        this.noGrp === true ? cNvPicPrEle.ele('a:picLocks').att('noGrp', 1) : null;\n        this.noSelect === true ? cNvPicPrEle.ele('a:picLocks').att('noSelect', 1) : null;\n        this.noRot === true ? cNvPicPrEle.ele('a:picLocks').att('noRot', 1) : null;\n        this.noChangeAspect === true ? cNvPicPrEle.ele('a:picLocks').att('noChangeAspect', 1) : null;\n        this.noMove === true ? cNvPicPrEle.ele('a:picLocks').att('noMove', 1) : null;\n        this.noResize === true ? cNvPicPrEle.ele('a:picLocks').att('noResize', 1) : null;\n        this.noEditPoints === true ? cNvPicPrEle.ele('a:picLocks').att('noEditPoints', 1) : null;\n        this.noAdjustHandles === true ? cNvPicPrEle.ele('a:picLocks').att('noAdjustHandles', 1) : null;\n        this.noChangeArrowheads === true ? cNvPicPrEle.ele('a:picLocks').att('noChangeArrowheads', 1) : null;\n        this.noChangeShapeType === true ? cNvPicPrEle.ele('a:picLocks').att('noChangeShapeType', 1) : null;\n\n        let blipFillEle = picEle.ele('xdr:blipFill');\n        blipFillEle.ele('a:blip').att('r:embed', this.rId).att('xmlns:r', 'http://schemas.openxmlformats.org/officeDocument/2006/relationships');\n        blipFillEle.ele('a:stretch').ele('a:fillRect');\n\n        let spPrEle = picEle.ele('xdr:spPr');\n        let xfrmEle = spPrEle.ele('a:xfrm');\n        xfrmEle.ele('a:off').att('x', 0).att('y', 0);\n        xfrmEle.ele('a:ext').att('cx', this.width).att('cy', this.height);\n\n        let prstGeom = spPrEle.ele('a:prstGeom').att('prst', 'rect');\n        prstGeom.ele('a:avLst');\n\n        anchorEle.ele('xdr:clientData');\n    }\n}\n\nmodule.exports = Picture;"]}